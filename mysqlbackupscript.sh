#!/bin/bash
baksrc=/var/lib/mysql
bakdst=/backup/mysqlbackup/daily
backupdst=/backup/mysqlbackup/
dumpdb=/usr/bin/mysqldump

rsync --progress -av $backupdst/daily5/*.sql  $backupdst/daily6/
echo "|-----------------------------------------------------------------------------------------------------------------|"
echo "|............................. .... Successfully updated (daily6) ................................................|"
echo "|-----------------------------------------------------------------------------------------------------------------|"

rsync --progress -av $backupdst/daily4/*.sql  $backupdst/daily5/
echo "|-----------------------------------------------------------------------------------------------------------------|"  
echo "|.................................. Successfully updated daily5...................................................|" 
echo "|-----------------------------------------------------------------------------------------------------------------|"  


rsync --progress -av $backupdst/daily3/*.sql  $backupdst/daily4/
echo "|-----------------------------------------------------------------------------------------------------------------|"  
echo "|.................................. Successfully updated daily4...................................................|" 
echo "|-----------------------------------------------------------------------------------------------------------------|"  


rsync --progress -av $backupdst/daily2/*.sql  $backupdst/daily3/
echo "|-----------------------------------------------------------------------------------------------------------------|"  
echo "|.................................. Successfully updated daily3...................................................|" 
echo "|-----------------------------------------------------------------------------------------------------------------|"  

rsync --progress -av $backupdst/daily1/*.sql  $backupdst/daily2/
echo "|-----------------------------------------------------------------------------------------------------------------|"  
echo "|.................................. Successfully updated daily2...................................................|" 
echo "|-----------------------------------------------------------------------------------------------------------------|"  

rsync --progress -av $backupdst/daily/*.sql  $backupdst/daily1/
echo "|-----------------------------------------------------------------------------------------------------------------|"  
echo "|.................................. Successfully updated daily1 ..................................................|" 
echo "|-----------------------------------------------------------------------------------------------------------------|"  

ls -lhd  $baksrc/*_* | awk '{print $9}' | cut -d/ -f5  > /root/mysqldd-list

for db in `cat /root/mysqldd-list` ;
do
$dumpdb $db > $bakdst/$db.sql  2> $bakdst/error.log
done
$dumpdb  mysql > $bakdst/mysql.sql 2> $bakdst/error.log

echo " All Databases backup up successfully to folder $bakdst/ "
echo " Check for any errors at : $bakdst/error.log "

echo "|-----------------------------------------------------------------------------------------------------------------|"  
echo "|.................................. Successfully updated daily  ..................................................|"          
echo "|-----------------------------------------------------------------------------------------------------------------|"  
ls -lah $bakdst/ > $bakdst/list.txt
cat $bakdst/error.log >> $bakdst/list.txt

du -sh $bakdst/*

exit 0
